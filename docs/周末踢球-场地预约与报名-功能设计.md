# 周末踢球：场地预约与报名 — 功能设计

## 一、需求摘要

- **场景**：一支约 30 人的队伍，每周末组织踢球；每周需提前预约场地，场地约 3～4 个可选，场地和出勤人员每周不固定。
- **范围**：仅服务本小团体，不考虑其他组织。
- **普通用户**：能查看本周末预约了哪个场地、几点，并可报名；报名成功后，由管理员安排出场位置。
- **管理员**：创建/编辑本周活动（选场地、定时间），查看报名名单，为每人安排出场位置。

---

## 二、功能设计

### 2.1 角色与能力

| 角色 | 能力 |
|------|------|
| **普通用户（队员）** | 看本周末活动（场地 + 时间）→ 报名 → 查看自己的出场位置（管理员安排后） |
| **活动创建者 / 球队管理员 / 队长** | 创建/编辑活动（选场地、定时间）→ 查看报名名单 → 为每人安排出场位置 |

### 2.2 核心流程

1. **管理员**：每周提前创建一条「本周末活动」，选择场地、填写日期与时间（含几点）。
2. **普通用户**：在首页/活动页看到「本周末活动」— 场地名 + 时间 → 点击「报名」。
3. **系统**：记录「某用户已报名该活动」（报名状态）。
4. **管理员**：在活动详情/报名管理里看到报名名单，为每人选择或填写「出场位置」（如前锋、左后卫等）。
5. **普通用户**：再次打开活动或首页，看到自己「已报名」且「出场位置：XX」。

### 2.3 概念说明

- **场地**：固定 3～4 个可选，由管理员维护名称（及可选地址）；创建活动时选一个。
- **活动**：每周末一条，包含「哪一天、几点、在哪个场地」；对应现有「活动」模型，增加与场地的关联。
- **报名**：用户对某次活动的「我要来」意向；对应一条出勤记录，状态为「已报名」。
- **出场位置**：管理员为已报名用户填写的场上位置（如前锋、左后卫等），便于当天排阵。

---

## 三、数据设计

### 3.1 场地（Venue）— 新增

| 字段 | 类型 | 说明 |
|------|------|------|
| id | uuid | 主键 |
| name | string | 场地名称（如「XX 足球公园 A 场」） |
| address | string? | 可选地址 |
| createdAt / updatedAt | datetime | 创建/更新时间 |

- 仅需维护 3～4 条场地数据，供创建活动时选择。

### 3.2 活动（Activity）— 扩展

- 现有字段：name, description, date, location, createdById, teamId 等。
- **新增**：`venueId`（可选，外键 → Venue）。有 venueId 时优先展示场地名称；无则继续用 `location` 文本。

### 3.3 出勤/报名（Attendance）— 扩展

- 现有：userId, activityId, status（present/absent/late）, notes。
- **status 扩展**：增加 `registered` = 已报名（尚未到场）。
- **新增字段**：`position`（string?）= 出场位置，由管理员填写。

流程对应：

- 用户点击报名 → 创建一条 Attendance，status = `registered`。
- 管理员安排位置 → 更新该条 Attendance 的 `position`。
- 活动当天可再根据实际到场情况，将 status 改为 present/absent/late（沿用现有逻辑）。

---

## 四、接口设计

### 4.1 场地

- `GET /venues` — 列表（当前仅本团体可见即可，可与 team 关联或全局）。
- `POST /venues` — 新增（管理员）。
- `PATCH /venues/:id`、`DELETE /venues/:id` — 修改、删除（管理员）。

（若暂不做后台维护，可先在前端写死 3～4 个场地名，或通过 seed 写入数据库。）

### 4.2 活动

- 现有 `GET /activities`：建议支持查询「本周末」或「即将开始」的活动（如 `?upcoming=1` 或按 date 筛选）。
- 现有 `POST /activities`、`PATCH /activities/:id`：请求体支持 `venueId`（可选）；返回活动时带出 `venue { id, name, address }`。
- **新增** `POST /activities/:id/register`：当前用户对某活动「报名」。逻辑：若该活动有 teamId，则仅该队成员可报名；创建 Attendance，status = `registered`。若已存在报名/出勤记录则返回友好提示。

### 4.3 出勤/报名与位置

- `PATCH /attendance/:id`：请求体增加 `position`（string?）。仅活动创建者或球队管理员/队长可修改；用于「安排出场位置」。
- `GET /activities/:id`：返回活动详情时包含报名列表（attendances），每条含 userId、username、status、position，便于管理员排阵和用户查看。

---

## 五、前端交互（要点）

1. **首页 / Dashboard**  
   - 展示「本周末活动」卡片：场地名（来自 Venue 或 location）、日期时间、[报名] 按钮。  
   - 若当前用户已报名：显示「已报名」，若管理员已填 position 则显示「出场位置：XX」。

2. **活动列表页**  
   - 支持筛选「即将开始」或「本周末」，列表项展示场地 + 时间；进入详情可报名。

3. **活动详情 / 报名管理（管理员）**  
   - 列表展示已报名用户（status = registered 或 present），每行可编辑「出场位置」并保存（调用 PATCH /attendance/:id）。  
   - 可选：简单下拉选择（前锋、边卫、中场等）或自由文本。

4. **场地管理（可选）**  
   - 管理员维护 3～4 个场地名称（及地址），创建活动时下拉选择。若暂不开发，可用活动上的「地点」文本代替，后续再接 Venue。

---

## 六、实现顺序建议

1. **数据与接口**：Schema 增加 Venue、Activity.venueId、Attendance.status(registered)、Attendance.position；迁移；实现场地 CRUD 与活动报名、安排位置接口。  
2. **本周末活动**：GET /activities 支持「本周末/即将开始」；前端首页展示 + 报名按钮。  
3. **管理员安排位置**：活动详情/报名列表 + 每行 position 编辑与保存。  
4. **场地选择**：创建/编辑活动时选择 Venue（或先用手填 location，再接 Venue）。

---

以上设计可直接作为开发规格使用；若你希望先做「无场地表、只用手填地点」的简化版，也可以先实现报名 + 出场位置，再补场地表与选择逻辑。
