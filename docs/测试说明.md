# 业余球队管理系统 - 测试说明

## 一、测试方式概览

| 类型 | 命令 | 说明 |
|------|------|------|
| **E2E 接口测试** | `npm run test:e2e` | 覆盖所有 API 与健康检查，需数据库已启动 |
| **页面可访问性检查** | `npm run test:pages` | 检查所有页面与 /health 返回 200，**需本地服务已启动** |

---

## 二、E2E 测试覆盖（`npm run test:e2e`）

### 1. 健康检查
- `GET /health`：返回 200 与 `status: ok`

### 2. 页面路由
- 在 E2E 中已跳过（Jest 环境下 sendFile 路径会 404），请用 `npm run test:pages` 或浏览器验证。

### 3. 认证 Auth
- `POST /auth/register`：注册成功
- `POST /auth/login`：登录成功
- `GET /auth/me`：带 token 返回当前用户；无 token 返回 401

### 4. 球队 Teams
- `GET /teams`：无 token 401；带 token 返回列表
- `POST /teams`：创建球队
- `GET /teams/:id`：获取单个球队
- `PATCH /teams/:id`：更新球队
- `GET /teams/:id/roster`：获取名单
- `DELETE /teams/:id`：删除球队

### 5. 场地 Venues
- `POST /venues`：创建场地
- `GET /venues`：列表
- `GET /venues/:id`：单个
- `PATCH /venues/:id`：更新
- `DELETE /venues/:id`：删除

### 6. 活动 Activities
- `POST /activities`：创建活动
- `GET /activities`、`GET /activities?upcoming=1`：列表
- `GET /activities/:id`：单个
- `POST /activities/:id/register`：报名
- `PATCH /activities/:id`：更新
- `DELETE /activities/:id`：删除

### 7. 用户头像
- `POST /users/me/avatar`：无文件时返回 400（接口存在且需 token）

### 8. 清理
- 按顺序删除活动、场地、球队，保证数据清理

---

## 三、页面检查（`npm run test:pages`）

**前提**：先启动服务（如 `npm run start:dev` 或 `npm run dev`），再在另一终端执行：

```bash
npm run test:pages
```

检查以下地址均返回 HTTP 200：

- `/health`
- `/`
- `/login.html`
- `/register.html`
- `/dashboard.html`
- `/teams.html`
- `/activities.html`
- `/tactics.html`
- `/profile.html`
- `/admin-dashboard.html`
- `/user-dashboard.html`

---

## 四、如何跑完整测试

1. **启动数据库**（若未启动）  
   ```bash
   docker-compose up -d postgres
   ```

2. **跑 E2E（接口 + 健康）**  
   ```bash
   npm run test:e2e
   ```

3. **启动应用**  
   ```bash
   npm run start:dev
   ```

4. **跑页面检查**  
   新开终端：  
   ```bash
   npm run test:pages
   ```

5. **浏览器手动验证**  
   访问 http://localhost:3000 ，逐页检查登录、注册、首页、球队、活动、战术板、个人中心等流程。

---

## 五、接口与页面清单（供对照）

### 接口

- `GET /health`
- `POST /auth/register`、`POST /auth/login`、`GET /auth/me`
- `POST /auth/create-admin`、`POST /auth/create-user`（需角色）
- `GET /teams`、`POST /teams`、`GET /teams/:id`、`PATCH /teams/:id`、`DELETE /teams/:id`
- `POST /teams/:id/members`、`DELETE /teams/:id/members/:memberId`、`PATCH /teams/:id/members/:memberId/number`
- `GET /teams/:id/roster`、`PATCH /teams/:id/admin`
- `GET /activities`、`POST /activities`、`GET /activities/:id`、`POST /activities/:id/register`、`PATCH /activities/:id`、`DELETE /activities/:id`
- `GET /venues`、`POST /venues`、`GET /venues/:id`、`PATCH /venues/:id`、`DELETE /venues/:id`
- `POST /users/me/avatar`

### 页面

- `/`（实际返回 login.html）
- `/login.html`、`/register.html`
- `/dashboard.html`、`/teams.html`、`/activities.html`、`/tactics.html`、`/profile.html`
- `/admin-dashboard.html`、`/user-dashboard.html`
